<div class="animated fadeIn ">

        <div *ngIf="errorMessage">
            <br>
            <alert type="danger">
                <strong>{{message}}</strong>
            </alert>
        </div>
        <div class="row ">
            <div style="width:100% !important;">
                <div class="card">
                    <div class="card-header">
                        <strong>بيانات المواطن</strong>
                        <div class="card-header-actions">
                            <button type="button" class="card-header-action btn btn-link btn-minimize" (click)="toggleCollapse()"><i class={{iconCollapse}}></i></button>
                        </div>
                    </div>
    
                    <div (collapsed)="collapsed($event)" (expanded)="expanded($event)" [collapse]="isCollapsed" class="card-body ">
                        <form class="form-horizontal" #f="ngForm" (ngSubmit)="f.form.valid && onSave()" novalidate>
    
                            <div class="form-group row">
                                <label class="col-md-2 col-form-label font-weight-bold" for="name">الاسم <b style="color: red">*</b></label>
                                <div class="col-md-6">
                                    <input [attr.disabled]="disabled ? '' : null" maxlength="100" [(ngModel)]="citizen.name" #name="ngModel" [ngClass]="{ 'is-invalid': f.submitted && name.invalid }" required type="text" name="name" class="form-control" placeholder="الاسم بالكامل">
                                    <div *ngIf="f.submitted && name.invalid" class="invalid-feedback">
                                        <div *ngIf="name.errors.required"> برجاء ادخال اسم المواطن</div>
                                        <div *ngIf="name.errors.maxlength">اسم المواطن لايتعدي 100حرف</div>
                                    </div>
                                </div>
                            </div>
    
                            <div class="form-group row">
                                <label class="col-md-2 col-form-label font-weight-bold" for="nationalId">الرقم القومي <b style="color: red">*</b></label>
                                <div class="col-md-6">
                                    <input [attr.disabled]="disabled ? '' : null" minlength="14" maxlength="14" (input)="onNationalIdChange($event.target.value)" [(ngModel)]="citizen.nationalId" #nationalId="ngModel" [ngClass]="{ 'is-invalid': f.submitted && nationalId.invalid }" required type="text" name="nationalId" class="form-control" placeholder="الرقم القومي">
                                    <div *ngIf="f.submitted && nationalId.invalid" class="invalid-feedback">
                                        <div *ngIf="nationalId.errors.required"> برجاء ادخال الرقم القومي</div>
                                        <div *ngIf="nationalId.errors.minlength">الرقم القومي يتكون من 14 رقم, ادخل الرقم صحيح</div>
                                        <div *ngIf="nationalId.errors.maxlength">الرقم القومي يتكون من 14 رقم, ادخل الرقم صحيح</div>
                                    </div>
                                </div>
                            </div>
    
                            <div class="form-group row">
                                <label class="col-md-2 col-form-label font-weight-bold" for="birthDate">تاريخ الميلاد <b style="color: red">*</b></label>
                                <div class="col-md-6">
                                    <!-- <input class="form-control"  type="text" [(ngModel)]="citizen.birthDate" #birthDate="ngModel" [ngClass]="{ 'is-invalid': f.submitted && birthDate.invalid }" name="birthDate" placeholder="YYYY-MM-DD" required /> -->
    
                                    <input [attr.disabled]="disabled ? '' : null" [(ngModel)]="citizen.birthDate" #birthDate="ngModel" [ngClass]="{ 'is-invalid': f.submitted && birthDate.invalid }" required class="form-control" type="date" name="birthDate" style="text-align: right" placeholder="date">
                                    <div *ngIf="f.submitted && birthDate.invalid" class="invalid-feedback">
                                        <div *ngIf="birthDate.errors.required"> برجاء ادخال تاريخ الميلاد</div>
                                        <!-- <div *ngIf="birthDate.errors.pattern"> التاريخ غير صحيح</div> -->
                                    </div>
                                </div>
                            </div>
    
                            <div class="form-group row">
                                <label class="col-md-2 col-form-label font-weight-bold" for="address">العنوان</label>
                                <div class="col-md-6">
                                    <input [attr.disabled]="disabled ? '' : null" maxlength="150" [(ngModel)]="citizen.address" #address="ngModel" [ngClass]="{ 'is-invalid': f.submitted && address.invalid }" type="text" name="address" class="form-control" placeholder="العنوان بالتفصيل">
                                    <div *ngIf="f.submitted && address.invalid" class="invalid-feedback">
                                        <div *ngIf="address.errors.maxlength"> العنوان لا يجب ان يتعدي 150 حرف </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-2 col-form-label font-weight-bold" for="mobileNumber">رقم الموبيل</label>
                                <div class="col-md-6">
                                    <input [attr.disabled]="disabled ? '' : null" maxlength="13" [(ngModel)]="citizen.mobileNumber" #mobileNumber="ngModel" [ngClass]="{ 'is-invalid': f.submitted && mobileNumber.invalid }" type="text" name="mobileNumber" class="form-control" placeholder="01xxxxxxxxx">
                                    <div *ngIf="f.submitted && mobileNumber.invalid" class="invalid-feedback">
                                        <div *ngIf="mobileNumber.errors.maxlength"> رقم الموبيل لا يجب ان يتعدي 13 رقم </div>
                                    </div>
                                </div>
                            </div>
    
                            <div class="form-group row">
                                <label class="col-md-2 col-form-label font-weight-bold" for="governate">المحافظة <b style="color: red">*</b></label>
                                <div class="col-md-6">
                                    <!-- <input name="governate"  class="form-control" type="text" list="governates-list" [(ngModel)]="selectedGovernateId" #governate="ngModel" [ngClass]="{ 'is-invalid': f.submitted && governate.invalid }" (change)="onGovernateChanged(governate.value)" required/> -->
                                    <select [attr.disabled]="disabled ? '' : null" name="governate" class="form-control" [(ngModel)]="selectedGovernateId" #governate="ngModel" [ngClass]="{ 'is-invalid': f.submitted && governate.invalid }" (change)="onGovernateChanged(governate.value)" required>
                                        <option *ngFor="let governate of governates" [value]="governate.id">{{governate.name}}</option>
                                    </select>
                                    <div *ngIf="f.submitted && governate.invalid" class="invalid-feedback">
                                        <div *ngIf="governate.errors.required"> برجاء اختيار المحافظة</div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-md-2 col-form-label font-weight-bold" for="city">المدينة <b style="color: red">*</b></label>
                                <div class="col-md-6">
                                    <select [attr.disabled]="disabled ? '' : null" [(ngModel)]="selectedCityId" #city="ngModel" [ngClass]="{ 'is-invalid': f.submitted && city.invalid }" name="city" class="form-control" required>
                                        <option *ngFor="let city of cities" [value]="city.id">{{city.name}}</option>
                                    </select>
                                    <div *ngIf="f.submitted && city.invalid" class="invalid-feedback">
                                        <div *ngIf="city.errors.required"> برجاء اختيار المدينة</div>
                                    </div>
                                </div>
                            </div>
    
                            <div class="form-group row">
                                <label class="col-md-2 col-form-label font-weight-bold" for="occupation">المهنه <b style="color: red">*</b></label>
                                <div class="col-md-6">
                                    <select [attr.disabled]="disabled ? '' : null" [(ngModel)]="selectedOccupationId" #occupation="ngModel" [ngClass]="{ 'is-invalid': f.submitted && occupation.invalid }" name="occupation" class="form-control" required>
                                        <option *ngFor="let occupation of occupations" [value]="occupation.id">{{occupation.name}}</option>
                                    </select>
                                    <div *ngIf="f.submitted && occupation.invalid" class="invalid-feedback">
                                        <div *ngIf="occupation.errors.required"> برجاء اختيار المهنة</div>
                                    </div>
                                </div>
                            </div>
    
                            <div class="form-group row">
                                <label class="col-md-2 col-form-label font-weight-bold" for="gender">النوع <b style="color: red">*</b></label>
                                <div class="col-md-6">
                                    <select [attr.disabled]="disabled ? '' : null" [(ngModel)]="selectedGenderId" #gender="ngModel" [ngClass]="{ 'is-invalid': f.submitted && gender.invalid }" name="gender" class="form-control" required>
                                        <option *ngFor="let gender of genders" [value]="gender.id">{{gender.name}}</option>
                                    </select>
                                    <div *ngIf="f.submitted && gender.invalid" class="invalid-feedback">
                                        <div *ngIf="gender.errors.required"> برجاء اختيار النوع</div>
                                    </div>
                                </div>
                            </div>
    
                            <div *ngIf="componentMode=='editMode'" class="card-footer">
                                <button type="submit" class="btn btn-sm btn-success"><i class="fa fa-dot-circle-o"></i>حفظ</button>
                                <button type="reset" class="btn btn-sm btn-danger" (click)="close()"><i class="fa fa-ban"></i> رجوع</button>
                            </div>
                            <div *ngIf="componentMode=='viewMode'" class="card-footer">
                                <button type="reset" class="btn btn-sm btn-danger" (click)="close()"><i class="fa fa-ban"></i> رجوع</button>
                            </div>
    
                        </form>
                    </div>
    
                </div>
    
            </div>
    
            <div style="width:100% !important;">
                <div class="card">
                    <div class="card-header">
                        <strong style="color: rgba(27, 17, 168, 0.582)">الطلبات</strong>
                        <div class="card-header-actions">
                            <button type="button" class="card-header-action btn btn-link btn-minimize" (click)="toggleCitizenRequestsCollapse()"><i class={{iconCitizenRequestsCollapse}}></i></button>
                        </div>
                    </div>
                    <div (collapsed)="citizenRequestsCollapsed($event)" (expanded)="citizenRequestsExpanded($event)" [collapse]="isCitizenRequestsCollapsed" class="card-body ">
                        <table class="table table-responsive-sm table-hover table-outline mb-0">
                            <thead class="thead-light">
                                <tr>
                                    <th scope="col">#</th>
                                    <th class="text-center">رقم الطلب</th>
                                    <th class="text-center">نوع الطلب</th>
                                    <th class="text-center">حالة الطلب</th>
                                    <th class="text-center"> الجمرك</th>
                                    <th class="text-center">المرور</th>
                                    <th class="text-center">تاريخ التسجيل</th>
                                    <th class="text-center">تعديل</th>
                                    <th class="text-center">حذف</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let request of requests ; let i=index">
                                    <td class="text-center"><b>{{i+1}}</b></td>
                                    <td class="text-center"><a [routerLink]="['/request/', request.id,{componentMode: 'viewMode', citizendId: request.citizen.id}]"><b>{{request.id}}</b></a></td>
    
                                    <td class="text-center">
                                        <b *ngIf="request.requestType != null">{{request.requestType.name}}</b>
                                    </td>
                                        
                                    <td class="text-center">
                                            <b *ngIf="request.requestStatus != null">{{request.requestStatus.name}}</b>
                                        </td>
                                    <td class="text-center">
                                        <b *ngIf="request.custom != null">{{request.custom.name}}</b>
                                    </td>
                                    <td class="text-center">
                                        <b *ngIf="request.trafficManagement != null">{{request.trafficManagement.name}}</b>
                                    </td>
                                    <td class="text-center">
                                        <b>{{request.requestDate}}</b>
                                    </td>
                                    <td class="text-center">
                                        <button [attr.disabled]="disabled ? '' : null" type="button" class="edit-btn btn btn-info" (click)="onEditRequest(request.id)">تعديل
                                            <i class="fa fa-edit"></i>
                                        </button>
                                    </td>
                                    <td class="text-center">
                                        <button [attr.disabled]="disabled ? '' : null" type="button" class="delete-btn btn btn-danger" (click)="onDeleteRequest(request.id)">حذف
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
    
                            </tbody>
                        </table>
                        <br/><br/><br/>
                        <div *ngIf="componentMode=='editMode'"> 
                            <form class="form-horizontal" #x="ngForm" (ngSubmit)="x.form.valid && createNewRequest()" novalidate>
                                <div class="form-group row">
                                        <label class="col-md-2 col-form-label font-weight-bold" for="requestType">نوع الطلب</label>
                                        <div class="col-md-6">
                                            <select name="requestType" class="form-control" [(ngModel)]="selectedRequestTypeId" #requestType="ngModel" >
                                                <option *ngFor="let r of requestTypes" [value]="r.id">{{r.name}}</option>
                                            </select>
                                            <!-- <div  class="invalid-feedback">
                                                    <div *ngIf="x.submitted && requestType.errors.required"> برجاء اختيار نوع الطلب</div>
                                            </div> -->
                                        </div>
                                </div>
                                <button type="submit" class="btn btn-sm btn-primary"><i class="fa fa-dot-circle-o"></i>طلب جديد</button>
                            </form>
                        </div> 
                    </div>
                </div>
            </div>
    
        </div>
    </div>